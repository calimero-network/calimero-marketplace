description: Bootstrap Simplified Calimero Marketplace with Demo Data
name: Calimero Marketplace Bootstrap

force_pull_image: true
auth_service: true

nodes:
  chain_id: testnet-1
  count: 1
  image: ghcr.io/calimero-network/merod:edge
  prefix: calimero-node

steps:
  # ========================================================================
  # PART 1: Install Application
  # ========================================================================

  - name: Install Marketplace Application
    type: install_application
    node: calimero-node-1
    path: logic/res/calimero_marketplace.wasm
    dev: true
    outputs:
      app_id: applicationId

  # ========================================================================
  # PART 2: Create and Initialize Marketplace
  # ========================================================================

  - name: Create Marketplace Context
    type: create_context
    node: calimero-node-1
    application_id: "{{app_id}}"
    outputs:
      context_id: contextId
      member_key: memberPublicKey

  - name: Setup Marketplace
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_key}}"
    method: setup_marketplace
    args:
      admin_wallet: "0xAdminWallet123456789"
      store_name: "TechGadgets Electronics Marketplace"
      type_of_goods: "Electronics & Accessories"
    outputs:
      setup_result: result

  - name: Wait for Marketplace Init
    type: wait
    seconds: 2

  # ========================================================================
  # PART 3: First Seller Requests Access and Gets Approved
  # ========================================================================

  - name: Seller 1 Request Access
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_key}}"
    method: request_seller_access
    args:
      wallet_address: "0xSellerWallet001"
      company_name: "TechSupplies Inc"
      company_details: "Leading supplier of electronic components and accessories since 2020"
      signature: "0xSignature_seller1_request"
    outputs:
      seller1_id: output

  - name: Wait for Seller Request
    type: wait
    seconds: 2

  - name: Admin Approve Seller 1
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_key}}"
    method: admin_approve_seller
    args:
      seller_id: "seller_1"
    outputs:
      seller1_approval: output

  - name: Wait for Seller Approval
    type: wait
    seconds: 2

  # ========================================================================
  # PART 4: Seller 1 Adds Products
  # ========================================================================

  - name: Add Product 1 - Wireless Mouse
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_key}}"
    method: add_product
    args:
      seller_wallet: "0xSellerWallet001"
      name: "Wireless Gaming Mouse"
      description: "High-precision wireless gaming mouse with RGB lighting, 16000 DPI sensor"
      quantity: 50
      price: "59.99"
      image_url: "https://placeholder.com/mouse.jpg"
      category: "Peripherals"
      shipping_info: "Free shipping, 2-3 business days"
      _signature: "0xSignature_product1"
    outputs:
      product1_id: output

  - name: Wait for Product 1
    type: wait
    seconds: 2

  - name: Add Product 2 - USB-C Hub
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_key}}"
    method: add_product
    args:
      seller_wallet: "0xSellerWallet001"
      name: "7-in-1 USB-C Hub"
      description: "Multi-port USB-C hub with HDMI 4K, USB 3.0, SD/microSD card reader, 100W PD charging"
      quantity: 100
      price: "49.99"
      image_url: "https://placeholder.com/usb-hub.jpg"
      category: "Accessories"
      shipping_info: "Free shipping, 2-3 business days"
      _signature: "0xSignature_product2"
    outputs:
      product2_id: output

  - name: Wait for Product 2
    type: wait
    seconds: 2

  - name: Add Product 3 - Mechanical Keyboard
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_key}}"
    method: add_product
    args:
      seller_wallet: "0xSellerWallet001"
      name: "RGB Mechanical Keyboard"
      description: "Gaming mechanical keyboard with RGB backlighting, hot-swappable switches, aluminum frame"
      quantity: 30
      price: "129.99"
      image_url: "https://placeholder.com/keyboard.jpg"
      category: "Peripherals"
      shipping_info: "Standard shipping, 3-5 business days"
      _signature: "0xSignature_product3"
    outputs:
      product3_id: output

  - name: Wait for Product 3
    type: wait
    seconds: 2

  # ========================================================================
  # PART 5: Second Seller Request (Pending for Demo)
  # ========================================================================

  - name: Seller 2 Request Access (Pending)
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_key}}"
    method: request_seller_access
    args:
      wallet_address: "0xSellerWallet002"
      company_name: "SmartHome Solutions"
      company_details: "Specializing in smart home devices and IoT products"
      signature: "0xSignature_seller2_request"
    outputs:
      seller2_id: output

  - name: Wait for Seller 2 Request
    type: wait
    seconds: 2

  # Note: Seller 2 is NOT approved - leaving as pending for demo

  # ========================================================================
  # PART 6: First Buyer Makes a Purchase
  # ========================================================================

  - name: Buyer 1 Purchase Product 1
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_key}}"
    method: purchase_product
    args:
      product_id: "prod_1"
      buyer_wallet: "0xBuyerWallet001"
      amount: "59.99"
      _signature: "0xSignature_purchase1"
    outputs:
      order1_id: output

  - name: Wait for Purchase
    type: wait
    seconds: 2

  # ========================================================================
  # PART 7: Verify Setup - Get All Data
  # ========================================================================

  - name: Get Marketplace Info
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_key}}"
    method: get_marketplace_info
    outputs:
      marketplace_info: output

  - name: Get All Products
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_key}}"
    method: get_products
    outputs:
      all_products: output

  - name: Get All Sellers
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_key}}"
    method: get_sellers
    outputs:
      all_sellers: output

  - name: Get Pending Seller Requests
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_key}}"
    method: get_pending_seller_requests
    outputs:
      pending_sellers: output

  - name: Get All Orders
    type: call
    node: calimero-node-1
    context_id: "{{context_id}}"
    executor_public_key: "{{member_key}}"
    method: get_orders
    outputs:
      all_orders: output

# Configuration
stop_all_nodes: false
restart: true
nuke: false
wait_timeout: 120
